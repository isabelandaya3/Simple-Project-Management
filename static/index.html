<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LEB Tracker - RFI & Submittal Management</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- Login Page -->
    <div id="login-page" class="login-page">
        <div class="login-card">
            <div class="login-logo">
                <div class="logo-icon">üìã</div>
                <h1>LEB Tracker</h1>
                <p>RFI & Submittal Management</p>
            </div>
            <form id="login-form">
                <div class="form-group">
                    <label for="login-email">Email</label>
                    <input type="email" id="login-email" placeholder="Enter your email" required>
                </div>
                <div class="form-group">
                    <label for="login-password">Password</label>
                    <input type="password" id="login-password" placeholder="Enter your password" required>
                </div>
                <button type="submit" class="btn btn-primary btn-full">Sign In</button>
                <p id="login-error" class="error-message"></p>
            </form>
            <div class="login-footer">
                <p>Default: admin@local / admin123</p>
            </div>
        </div>
    </div>

    <!-- Main App -->
    <div id="app" class="app hidden">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="app-logo">
                    <span class="logo-emoji">üìã</span>
                    <span class="logo-text" id="app-title">Tracker</span>
                </div>
                <button class="btn-collapse-sidebar" id="btn-collapse-sidebar" title="Collapse Sidebar">‚óÄ</button>
            </div>

            <!-- Project Section -->
            <div class="sidebar-section">
                <h3 class="sidebar-section-title">Project</h3>
                <div class="project-selector">
                    <select id="project-selector" class="project-dropdown">
                        <option value="">Loading...</option>
                    </select>
                    <button class="btn btn-icon-only btn-small" id="btn-add-project" title="Add New Project" style="display:none;">
                        <span>+</span>
                    </button>
                </div>
                <div class="project-card" style="display:none;">
                    <div class="project-name" id="project-name">Loading...</div>
                    <div class="project-subtitle">RFI & Submittal Management</div>
                </div>
            </div>

            <!-- Integrations Section -->
            <div class="sidebar-section">
                <h3 class="sidebar-section-title">Integrations</h3>
                <button class="btn btn-outline btn-full btn-disabled" id="btn-connect-acc">
                    <span class="btn-icon">üîó</span>
                    Connect to ACC (Coming Soon)
                </button>
                <button class="btn btn-outline btn-full btn-disabled" id="btn-import-acc">
                    <span class="btn-icon">üì•</span>
                    Import from ACC (Future)
                </button>
            </div>

            <!-- Navigation Tabs -->
            <div class="sidebar-section">
                <h3 class="sidebar-section-title">Views</h3>
                <nav class="nav-tabs">
                    <button class="nav-tab" data-view="inbox">
                        <span class="nav-tab-icon">üì•</span>
                        <span class="nav-tab-label">My Inbox</span>
                        <span class="nav-tab-count" id="count-inbox">0</span>
                    </button>
                    <button class="nav-tab" data-view="workflow">
                        <span class="nav-tab-icon">üìß</span>
                        <span class="nav-tab-label">Email & Responses</span>
                    </button>
                    <button class="nav-tab" data-view="pending-updates" id="nav-pending-updates" style="display:none;">
                        <span class="nav-tab-icon">üîÑ</span>
                        <span class="nav-tab-label">Contractor Updates</span>
                        <span class="nav-tab-count pending-updates-badge" id="count-pending-updates">0</span>
                    </button>
                    <button class="nav-tab" data-view="notifications">
                        <span class="nav-tab-icon">üîî</span>
                        <span class="nav-tab-label">Notifications</span>
                        <span class="nav-tab-count notification-badge" id="count-notifications">0</span>
                    </button>
                    <button class="nav-tab" data-view="reminders">
                        <span class="nav-tab-icon">‚è∞</span>
                        <span class="nav-tab-label">Reminders</span>
                    </button>
                    <div class="nav-divider"></div>
                    <button class="nav-tab active" data-bucket="ALL">
                        <span class="nav-tab-icon">üìÅ</span>
                        <span class="nav-tab-label">All Items</span>
                        <span class="nav-tab-count" id="count-all">0</span>
                    </button>
                    <button class="nav-tab" data-bucket="ACC_TURNER">
                        <span class="nav-tab-icon">üèóÔ∏è</span>
                        <span class="nav-tab-label">ACC Turner</span>
                        <span class="nav-tab-count" id="count-turner">0</span>
                    </button>
                    <button class="nav-tab" data-bucket="ACC_MORTENSON">
                        <span class="nav-tab-icon">üè¢</span>
                        <span class="nav-tab-label">ACC Mortenson</span>
                        <span class="nav-tab-count" id="count-mortenson">0</span>
                    </button>
                    <button class="nav-tab" data-bucket="ACC_FTI">
                        <span class="nav-tab-icon">‚ö°</span>
                        <span class="nav-tab-label">ACC FTI</span>
                        <span class="nav-tab-count" id="count-fti">0</span>
                    </button>
                </nav>
            </div>

            <!-- Quick Filters -->
            <div class="sidebar-section">
                <h3 class="sidebar-section-title">Quick Filters</h3>
                <div class="quick-filters">
                    <button class="filter-chip" data-filter="type" data-value="">All Types</button>
                    <button class="filter-chip" data-filter="type" data-value="RFI">RFIs Only</button>
                    <button class="filter-chip" data-filter="type" data-value="Submittal">Submittals Only</button>
                </div>
            </div>

            <!-- Polling Status -->
            <div class="sidebar-section sidebar-footer">
                <div class="polling-status">
                    <span class="status-dot" id="polling-dot"></span>
                    <span class="status-text" id="polling-status">Checking...</span>
                </div>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Header -->
            <header class="main-header">
                <div class="header-left">
                    <h1 class="page-title" id="page-title">All Items</h1>
                    <p class="page-subtitle" id="page-subtitle">RFIs & Submittals</p>
                </div>
                <div class="header-stats">
                    <div class="stat-card">
                        <span class="stat-value" id="stat-open">0</span>
                        <span class="stat-label">Open</span>
                    </div>
                    <div class="stat-card stat-warning">
                        <span class="stat-value" id="stat-overdue">0</span>
                        <span class="stat-label">Overdue</span>
                    </div>
                    <div class="stat-card">
                        <span class="stat-value" id="stat-due-week">0</span>
                        <span class="stat-label">Due This Week</span>
                    </div>
                </div>
                <div class="header-right">
                    <button class="btn btn-outline" id="btn-select-mode" title="Select multiple items to delete">
                        ‚òê Select Items
                    </button>
                    <button class="btn btn-danger hidden" id="btn-delete-selected" disabled style="background:#dc3545; border-color:#dc3545;">
                        üóëÔ∏è Delete Selected (0)
                    </button>
                    <button class="btn btn-outline hidden" id="btn-cancel-select">
                        ‚úï Cancel
                    </button>
                    <button class="btn btn-primary" id="btn-new-item">
                        <span>+</span> New Item
                    </button>
                    <div class="user-menu">
                        <button class="user-avatar" id="user-avatar">
                            <span id="user-initials">A</span>
                        </button>
                        <div class="user-dropdown hidden" id="user-dropdown">
                            <div class="dropdown-header">
                                <span id="user-name">User</span>
                                <span id="user-email" class="text-muted">user@local</span>
                            </div>
                            <hr>
                            <button class="dropdown-item" id="btn-manage-users">
                                <span>üë•</span> Project Team
                            </button>
                            <button class="dropdown-item" id="btn-settings">
                                <span>‚öôÔ∏è</span> Settings
                            </button>
                            <hr>
                            <button class="dropdown-item" id="btn-logout">
                                <span>üö™</span> Sign Out
                            </button>
                        </div>
                    </div>
                </div>
            </header>

            <!-- Items Table -->
            <div class="table-container" id="table-container">
                <table class="items-table" id="items-table">
                    <thead>
                        <tr>
                            <th>Type</th>
                            <th>Identifier</th>
                            <th>Title</th>
                            <th>Date Recv'd</th>
                            <th>Priority</th>
                            <th>Contractor Due</th>
                            <th>Reviewer Due</th>
                            <th>QCR Due</th>
                            <th>Status</th>
                            <th>Ball in Court</th>
                            <th>Initial Reviewer</th>
                            <th>QCR</th>
                        </tr>
                    </thead>
                    <tbody id="items-table-body">
                        <!-- Items will be loaded here -->
                    </tbody>
                </table>
                <div class="empty-state hidden" id="empty-state">
                    <div class="empty-icon">üì≠</div>
                    <h3>No items found</h3>
                    <p>Items from ACC emails will appear here automatically, or create one manually.</p>
                </div>
            </div>

            <!-- Workflow View -->
            <div class="workflow-container hidden" id="workflow-container">
                <div class="workflow-header">
                    <h2>üìß Email & Response Workflow</h2>
                    <p>Monitor reviewer assignments and response status</p>
                </div>
                <table class="workflow-table">
                    <thead>
                        <tr>
                            <th>Item</th>
                            <th>Initial Reviewer</th>
                            <th>Reviewer Response</th>
                            <th>QCR</th>
                            <th>QC Decision</th>
                            <th>Final Response</th>
                            <th>Folder</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="workflow-table-body">
                        <!-- Workflow items will be loaded here -->
                    </tbody>
                </table>
                <div class="empty-state hidden" id="workflow-empty-state">
                    <div class="empty-icon">üìß</div>
                    <h3>No workflow items</h3>
                    <p>Items with assigned reviewers will appear here.</p>
                </div>
            </div>

            <!-- Notifications View -->
            <div class="notifications-container hidden" id="notifications-container">
                <div class="notifications-header">
                    <h2>üîî Notifications</h2>
                    <p>System updates and action items</p>
                    <div class="notifications-actions">
                        <button class="btn btn-secondary btn-sm" id="btn-mark-all-read">Mark All Read</button>
                    </div>
                </div>
                <div class="notifications-list" id="notifications-list">
                    <!-- Notifications will be loaded here -->
                </div>
                <div class="empty-state hidden" id="notifications-empty-state">
                    <div class="empty-icon">üîî</div>
                    <h3>No notifications</h3>
                    <p>You're all caught up! Notifications will appear here when there are updates.</p>
                </div>
            </div>

            <!-- Reminders View -->
            <div class="reminders-container hidden" id="reminders-container">
                <div class="reminders-header">
                    <h2>‚è∞ Reminder Management</h2>
                    <p>Track and send reminders for pending reviews</p>
                    <div class="reminders-actions">
                        <button class="btn btn-primary btn-sm" id="btn-process-reminders">Send All Pending Reminders</button>
                        <button class="btn btn-secondary btn-sm" id="btn-refresh-reminders">Refresh</button>
                    </div>
                </div>
                
                <!-- Reminder Status -->
                <div class="reminder-status-card" id="reminder-status-card">
                    <div class="status-row">
                        <span class="status-label">Scheduler Status:</span>
                        <span class="status-value" id="reminder-scheduler-status">--</span>
                    </div>
                    <div class="status-row">
                        <span class="status-label">Reminder Time:</span>
                        <span class="status-value" id="reminder-time">--</span>
                    </div>
                    <div class="status-row">
                        <span class="status-label">Last Check:</span>
                        <span class="status-value" id="reminder-last-check">--</span>
                    </div>
                </div>
                
                <!-- Pending Reminders Section -->
                <div class="reminder-section">
                    <h3>üì® Pending Reminders</h3>
                    <p class="section-description">Items that need reminders sent today</p>
                    <div class="pending-reminders-list" id="pending-reminders-list">
                        <!-- Pending reminders will be loaded here -->
                    </div>
                </div>
                
                <!-- Reminder History Section -->
                <div class="reminder-section">
                    <h3>üìú Reminder History</h3>
                    <p class="section-description">Recently sent reminders</p>
                    <div class="reminder-history-list" id="reminder-history-list">
                        <!-- Reminder history will be loaded here -->
                    </div>
                </div>
            </div>

            <!-- Pending Contractor Updates View (Admin Only) -->
            <div class="pending-updates-container hidden" id="pending-updates-container">
                <div class="pending-updates-header">
                    <h2>üîÑ Contractor Updates</h2>
                    <p>Items updated by contractor that need admin review</p>
                    <div class="pending-updates-actions">
                        <button class="btn btn-secondary btn-sm" id="btn-refresh-updates">Refresh</button>
                    </div>
                </div>
                <div class="pending-updates-list" id="pending-updates-list">
                    <!-- Pending updates will be loaded here -->
                </div>
                <div class="empty-state hidden" id="pending-updates-empty-state">
                    <div class="empty-icon">‚úÖ</div>
                    <h3>No pending updates</h3>
                    <p>All contractor updates have been reviewed. Items will appear here when contractors make changes.</p>
                </div>
            </div>
        </main>

        <!-- Detail Drawer -->
        <div class="drawer-overlay hidden" id="drawer-overlay"></div>
        <aside class="detail-drawer hidden" id="detail-drawer">
            <div class="drawer-header">
                <h2 id="drawer-title">Item Details</h2>
                <button class="btn-close" id="btn-close-drawer">&times;</button>
            </div>
            <div class="drawer-content">
                <!-- Warning Banner for Insufficient Window -->
                <div class="warning-banner hidden" id="insufficient-window-warning">
                    <span class="warning-icon">‚ö†Ô∏è</span>
                    <span id="warning-text">Contractor provided insufficient review window</span>
                </div>

                <!-- Contractor Update Review Panel (Admin Only) -->
                <div id="contractor-update-panel" class="hidden">
                    <!-- Dynamic content will be rendered by JavaScript -->
                </div>

                <!-- Item Info -->
                <div class="drawer-section">
                    <div class="info-row">
                        <span class="info-label">Type</span>
                        <span class="chip" id="detail-type">-</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Bucket</span>
                        <select id="detail-bucket" class="bucket-select">
                            <option value="ALL">General (All)</option>
                            <option value="ACC_TURNER">Turner</option>
                            <option value="ACC_MORTENSON">Mortenson</option>
                            <option value="ACC_FTI">FTI</option>
                        </select>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Identifier</span>
                        <span id="detail-identifier">-</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Date Received</span>
                        <span id="detail-date-received">-</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Created</span>
                        <span id="detail-created">-</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Last Email</span>
                        <span id="detail-last-email">-</span>
                    </div>
                </div>

                <!-- Original Subject with Open Email Button -->
                <div class="drawer-section">
                    <div class="email-section-header">
                        <label class="section-label">Original Subject</label>
                        <button class="btn btn-outline btn-sm" id="btn-open-email" title="Open original email in Outlook">
                            üìß Open Email
                        </button>
                    </div>
                    <p class="text-muted" id="detail-subject">-</p>
                </div>

                <!-- Editable Fields -->
                <div class="drawer-section">
                    <div class="form-group">
                        <label for="detail-title-input">Title</label>
                        <input type="text" id="detail-title-input" placeholder="Enter title">
                    </div>
                    
                    <!-- Due Dates Section -->
                    <div class="due-dates-section">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="detail-due-date">Contractor Due Date</label>
                                <input type="date" id="detail-due-date">
                            </div>
                            <div class="form-group">
                                <label for="detail-priority">Priority</label>
                                <select id="detail-priority">
                                    <option value="">Not Set</option>
                                    <option value="High">High</option>
                                    <option value="Medium">Medium</option>
                                    <option value="Low">Low</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-row calculated-dates">
                            <div class="form-group">
                                <label for="detail-initial-reviewer-due">Initial Reviewer Due</label>
                                <input type="date" id="detail-initial-reviewer-due" class="calculated-date-input">
                            </div>
                            <div class="form-group">
                                <label for="detail-qcr-due">QCR Due</label>
                                <input type="date" id="detail-qcr-due" class="calculated-date-input">
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="detail-status">Status</label>
                        <select id="detail-status">
                            <option value="Unassigned">Unassigned</option>
                            <option value="Assigned">Assigned to Initial Reviewer</option>
                            <option value="In Review">Under Review</option>
                            <option value="In QC">Under QC</option>
                            <option value="Ready for Response">Ready for Response</option>
                            <option value="Closed">Closed</option>
                        </select>
                    </div>
                    
                    <!-- Reviewer Assignment (Chip-based selection) -->
                    <div class="reviewer-section">
                        <div class="form-group">
                            <label>Initial Reviewer(s)</label>
                            <div class="reviewer-chips-container" id="reviewer-chips-container">
                                <div class="reviewer-chips-area" id="reviewer-chips-area">
                                    <!-- Selected reviewer chips will appear here -->
                                </div>
                                <div class="reviewer-input-wrapper">
                                    <input type="text" id="reviewer-search-input" placeholder="Type to search and add reviewers..." autocomplete="off">
                                    <div class="reviewer-dropdown" id="reviewer-dropdown">
                                        <!-- Dropdown options will be loaded here -->
                                    </div>
                                </div>
                            </div>
                            <p class="section-help-text" style="margin-top: 4px; font-size: 11px; color: #666;">
                                Click names to add. Multiple reviewers = QCR notified when ALL respond.
                            </p>
                        </div>
                        
                        <div class="form-group">
                            <label for="detail-qcr">Quality Control Reviewer (QCR)</label>
                            <!-- Hidden select for form data -->
                            <select id="detail-qcr" style="display:none;">
                                <option value="">Not Assigned</option>
                            </select>
                            <!-- Autocomplete search input -->
                            <div class="qcr-autocomplete-container" id="qcr-autocomplete-container">
                                <input type="text" id="qcr-search-input" placeholder="Type to search QCR..." autocomplete="off">
                                <div class="qcr-dropdown" id="qcr-dropdown">
                                    <!-- Dropdown options will be loaded here -->
                                </div>
                            </div>
                        </div>
                        <p class="reviewer-error hidden" id="reviewer-error">‚ö†Ô∏è Initial Reviewer and QCR must be different users</p>
                        
                        <!-- Email Workflow Actions -->
                        <div class="workflow-actions" id="workflow-actions">
                            <button class="btn btn-success" id="btn-send-to-reviewer">
                                üìß Send to Reviewer
                            </button>
                            <button class="btn btn-warning btn-sm" id="btn-send-reminder" title="Send reminder email">
                                ‚è∞ Send Reminder
                            </button>
                            <div class="workflow-status hidden" id="workflow-status-info">
                                <p id="workflow-status-text"></p>
                            </div>
                        </div>
                        
                        <!-- Reviewer Response Status (shown when emails sent) -->
                        <div id="reviewer-status-list" class="reviewer-status-list">
                            <!-- Response status badges will appear here -->
                        </div>
                    </div>
                    
                </div>

                <!-- Folder Link -->
                <div class="drawer-section">
                    <label class="section-label">Files Folder</label>
                    <!-- Folder Warning Banner (shown when folder is missing) -->
                    <div id="folder-warning-banner" class="alert alert-warning hidden" style="margin-bottom: 10px; padding: 10px; background: #fff3cd; border: 1px solid #ffc107; border-radius: 4px;">
                        <span style="color: #856404;">‚ö†Ô∏è <strong>Folder not found.</strong> The folder may have been renamed or moved.</span>
                    </div>
                    <div class="folder-link-group">
                        <input type="text" id="detail-folder" placeholder="Path to folder" readonly>
                        <button class="btn btn-outline btn-sm" id="btn-open-folder" title="Open folder in Explorer">
                            üìÇ Open
                        </button>
                        <button class="btn btn-outline btn-sm hidden" id="btn-relocate-folder" title="Find or set new folder path" style="background: #fff3cd;">
                            üîç Relocate
                        </button>
                    </div>
                    <!-- Relocate Folder Panel (hidden by default) -->
                    <div id="relocate-folder-panel" class="hidden" style="margin-top: 10px; padding: 10px; background: #f8f9fa; border: 1px solid #ddd; border-radius: 4px;">
                        <p style="font-size: 12px; margin-bottom: 8px;"><strong>Potential matches found:</strong></p>
                        <div id="relocate-folder-list" style="max-height: 150px; overflow-y: auto; margin-bottom: 10px;">
                            <!-- Folder options will be populated here -->
                        </div>
                        <div style="margin-top: 8px;">
                            <label style="font-size: 12px; display: block; margin-bottom: 4px;">Or enter path manually:</label>
                            <div style="display: flex; gap: 5px;">
                                <input type="text" id="relocate-folder-input" placeholder="Enter full folder path" style="flex: 1; font-size: 12px; padding: 5px;">
                                <button class="btn btn-primary btn-sm" id="btn-confirm-relocate">Set Path</button>
                            </div>
                        </div>
                        <button class="btn btn-outline btn-sm" id="btn-cancel-relocate" style="margin-top: 8px;">Cancel</button>
                    </div>
                </div>

                <!-- Notes -->
                <div class="drawer-section">
                    <label class="section-label">Notes</label>
                    <textarea id="detail-notes" rows="3" placeholder="Add notes..."></textarea>
                </div>

                <!-- RFI Question (shown only for RFI type) -->
                <div class="drawer-section hidden" id="rfi-question-section">
                    <label class="section-label">RFI Question</label>
                    <textarea id="detail-rfi-question" rows="4" placeholder="Enter the RFI question..."></textarea>
                    <p style="font-size: 12px; color: #666; margin-top: 4px;">This question will be displayed in emails and response forms</p>
                </div>

                <!-- Save Button -->
                <div class="drawer-section">
                    <button class="btn btn-primary btn-full" id="btn-save-item">Save Changes</button>
                </div>

                <!-- Response Section (hidden when QCR final response exists, shown on manual modify) -->
                <div class="drawer-section response-section" id="response-section">
                    <label class="section-label">Reviewer Response</label>
                    <div class="form-group">
                        <label for="detail-response-category">Response Category</label>
                        <select id="detail-response-category">
                            <option value="">-- Select --</option>
                            <option value="Approved">Approved</option>
                            <option value="Approved as Noted">Approved as Noted</option>
                            <option value="Revise and Resubmit">Revise and Resubmit</option>
                            <option value="Rejected">Rejected</option>
                            <option value="For Information Only">For Information Only</option>
                            <option value="See Attached">See Attached</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="detail-response-text">Response Notes</label>
                        <textarea id="detail-response-text" rows="3" placeholder="Enter response details and file names..."></textarea>
                    </div>
                    <div class="form-group">
                        <label>Response Files</label>
                        <div id="file-list" class="file-checkbox-list">
                            <p class="text-muted">No folder linked. Set a folder path above first.</p>
                        </div>
                    </div>
                    <button class="btn btn-outline btn-full" id="btn-save-response">üíæ Save Response</button>
                </div>

                <!-- Closeout Actions -->
                <div class="drawer-section closeout-section">
                    <button class="btn btn-success btn-full" id="btn-close-item">‚úÖ Close Out Item</button>
                    <button class="btn btn-warning btn-full hidden" id="btn-reopen-item">üîÑ Undo Closeout (Admin)</button>
                    <p id="closed-at-info" class="text-muted text-center hidden"></p>
                </div>
                
                <!-- Previous Responses History (shown for reopened items) -->
                <div class="drawer-section hidden" id="previous-responses-section">
                    <label class="section-label">üìú Previous Response History</label>
                    <div id="previous-responses-list">
                        <!-- Previous responses will be loaded here -->
                    </div>
                </div>
                
                <!-- Delete Item (Admin) -->
                <div class="drawer-section">
                    <button class="btn btn-danger btn-full" id="btn-delete-item" style="background:#dc3545; border-color:#dc3545;">üóëÔ∏è Delete Item</button>
                </div>

                <!-- Comments -->
                <div class="drawer-section">
                    <label class="section-label">Comments</label>
                    <div id="comments-list" class="comments-list">
                        <!-- Comments will be loaded here -->
                    </div>
                    <div class="add-comment">
                        <textarea id="new-comment" rows="2" placeholder="Add a comment..."></textarea>
                        <button class="btn btn-outline btn-sm" id="btn-add-comment">Add Comment</button>
                    </div>
                </div>
            </div>
        </aside>
    </div>

    <!-- New Item Modal -->
    <div class="modal-overlay hidden" id="new-item-modal">
        <div class="modal">
            <div class="modal-header">
                <h2>Create New Item</h2>
                <button class="btn-close" id="btn-close-new-item">&times;</button>
            </div>
            <div class="modal-body">
                <form id="new-item-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="new-type">Type *</label>
                            <select id="new-type" required>
                                <option value="Submittal">Submittal</option>
                                <option value="RFI">RFI</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="new-bucket">Bucket</label>
                            <select id="new-bucket">
                                <option value="ALL">General</option>
                                <option value="ACC_TURNER">ACC Turner</option>
                                <option value="ACC_MORTENSON">ACC Mortenson</option>
                                <option value="ACC_FTI">ACC FTI</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="new-identifier">Identifier *</label>
                        <input type="text" id="new-identifier" placeholder="e.g., Submittal #13 34 19-2" required>
                    </div>
                    <div class="form-group">
                        <label for="new-title">Title</label>
                        <input type="text" id="new-title" placeholder="Enter a title">
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="new-due-date">Due Date</label>
                            <input type="date" id="new-due-date">
                        </div>
                        <div class="form-group">
                            <label for="new-priority">Priority</label>
                            <select id="new-priority">
                                <option value="">Not Set</option>
                                <option value="High">High</option>
                                <option value="Medium">Medium</option>
                                <option value="Low">Low</option>
                            </select>
                        </div>
                    </div>
                    <button type="submit" class="btn btn-primary btn-full">Create Item</button>
                </form>
            </div>
        </div>
    </div>

    <!-- ACC Modal (Placeholder) -->
    <div class="modal-overlay hidden" id="acc-modal">
        <div class="modal">
            <div class="modal-header">
                <h2>Autodesk Construction Cloud Integration</h2>
                <button class="btn-close" id="btn-close-acc">&times;</button>
            </div>
            <div class="modal-body">
                <div class="acc-placeholder">
                    <div class="acc-icon">üîó</div>
                    <h3>Coming Soon</h3>
                    <p>In a future version, this will connect directly to Autodesk Construction Cloud via API to import RFIs and Submittals.</p>
                    <p class="text-muted">For now, items are imported automatically through Outlook email monitoring.</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Manage Project Team Modal -->
    <div class="modal-overlay hidden" id="users-modal">
        <div class="modal modal-lg">
            <div class="modal-header">
                <h2>Project Team</h2>
                <button class="btn-close" id="btn-close-users">&times;</button>
            </div>
            <div class="modal-body">
                <div class="users-list" id="users-list">
                    <!-- Team members will be loaded here -->
                </div>
                <hr>
                <h3>Add Team Member</h3>
                <form id="new-user-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="new-user-email">Email *</label>
                            <div class="autocomplete-wrapper">
                                <input type="email" id="new-user-email" required autocomplete="off" placeholder="Start typing to search Outlook...">
                                <div class="autocomplete-dropdown hidden" id="email-autocomplete"></div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="new-user-name">Display Name</label>
                            <input type="text" id="new-user-name" placeholder="Optional - defaults to email">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="new-user-password">Password</label>
                            <input type="password" id="new-user-password" placeholder="Optional - for login access">
                            <small class="form-hint">Leave blank for team members who don't need to log in</small>
                        </div>
                        <div class="form-group">
                            <label for="new-user-role">Role</label>
                            <select id="new-user-role">
                                <option value="user">Team Member</option>
                                <option value="admin">Admin</option>
                            </select>
                        </div>
                    </div>
                    <button type="submit" class="btn btn-primary">Add Team Member</button>
                </form>
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div class="modal-overlay hidden" id="settings-modal">
        <div class="modal modal-lg">
            <div class="modal-header">
                <h2>Settings</h2>
                <button class="btn-close" id="btn-close-settings">&times;</button>
            </div>
            <div class="modal-body">
                <form id="settings-form">
                    <h3 style="margin-bottom: 15px; border-bottom: 1px solid #ddd; padding-bottom: 10px;">General Settings</h3>
                    <div class="form-group">
                        <label for="setting-project-name">Project Name</label>
                        <input type="text" id="setting-project-name">
                    </div>
                    <div class="form-group">
                        <label for="setting-base-folder">Base Folder Path (Project Files Root)</label>
                        <input type="text" id="setting-base-folder" placeholder="e.g., \\server\share\project">
                        <small class="form-hint">All RFI and Submittal folders will be created here. Subfolders by contractor and type are auto-generated.</small>
                    </div>
                    <div class="form-group">
                        <label for="setting-outlook-folder">Outlook Folder</label>
                        <input type="text" id="setting-outlook-folder" placeholder="Inbox or folder name">
                    </div>
                    <div class="form-group">
                        <label for="setting-poll-interval">Poll Interval (minutes)</label>
                        <input type="number" id="setting-poll-interval" min="1" max="60">
                    </div>
                    
                    <h3 style="margin-top: 25px; margin-bottom: 15px; border-bottom: 1px solid #ddd; padding-bottom: 10px;">Due Date Settings</h3>
                    <p style="color: #666; font-size: 0.9em; margin-bottom: 15px;">
                        Set the number of <strong>business days</strong> required for reviewer response based on priority level.
                    </p>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                        <div style="background: #f8f9fa; padding: 15px; border-radius: 8px;">
                            <h4 style="margin: 0 0 10px 0; color: #0d6efd;">üì¶ Submittal Due Dates</h4>
                            <div class="form-group">
                                <label for="setting-submittal-low">Low Priority (days)</label>
                                <input type="number" id="setting-submittal-low" min="1" max="60" value="20">
                            </div>
                            <div class="form-group">
                                <label for="setting-submittal-medium">Medium Priority (days)</label>
                                <input type="number" id="setting-submittal-medium" min="1" max="60" value="10">
                            </div>
                            <div class="form-group">
                                <label for="setting-submittal-high">High Priority (days)</label>
                                <input type="number" id="setting-submittal-high" min="1" max="60" value="5">
                            </div>
                        </div>
                        
                        <div style="background: #f8f9fa; padding: 15px; border-radius: 8px;">
                            <h4 style="margin: 0 0 10px 0; color: #198754;">üìã RFI Due Dates</h4>
                            <div class="form-group">
                                <label for="setting-rfi-low">Low Priority (days)</label>
                                <input type="number" id="setting-rfi-low" min="1" max="60" value="15">
                            </div>
                            <div class="form-group">
                                <label for="setting-rfi-medium">Medium Priority (days)</label>
                                <input type="number" id="setting-rfi-medium" min="1" max="60" value="7">
                            </div>
                            <div class="form-group">
                                <label for="setting-rfi-high">High Priority (days)</label>
                                <input type="number" id="setting-rfi-high" min="1" max="60" value="3">
                            </div>
                        </div>
                    </div>
                    
                    <div style="margin-top: 15px;">
                        <div class="form-group">
                            <label for="setting-qcr-review-days">QCR Review Days</label>
                            <input type="number" id="setting-qcr-review-days" min="1" max="10" value="2">
                            <small class="form-hint">Business days for QCR review (QCR due date is always 1 day before contractor due date)</small>
                        </div>
                    </div>
                    
                    <h3 style="margin-top: 25px; margin-bottom: 15px; border-bottom: 1px solid #ddd; padding-bottom: 10px;">Admin Tools</h3>
                    <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                        <button type="button" class="btn btn-outline" id="btn-export-submittals-excel">
                            üìä Export Submittals to Excel
                        </button>
                    </div>
                    <p id="export-result" style="margin-top: 10px; color: #666; font-size: 0.9em;"></p>
                    
                    <button type="submit" class="btn btn-primary btn-full" style="margin-top: 20px;">Save Settings</button>
                </form>
            </div>
        </div>
    </div>

    <!-- Add Project Modal -->
    <div class="modal-overlay hidden" id="project-modal">
        <div class="modal modal-lg">
            <div class="modal-header">
                <h2>Add New Project</h2>
                <button class="btn-close" id="btn-close-project">&times;</button>
            </div>
            <div class="modal-body">
                <form id="new-project-form">
                    <h3 style="margin-bottom: 15px; border-bottom: 1px solid #ddd; padding-bottom: 10px;">Project Information</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="project-name-input">Project Name *</label>
                            <input type="text" id="project-name-input" required placeholder="e.g., Berkeley Lab Extension">
                        </div>
                        <div class="form-group">
                            <label for="project-short-name">Short Name *</label>
                            <input type="text" id="project-short-name" required placeholder="e.g., LEB" maxlength="10">
                            <small class="form-hint">Used in email subject patterns and UI. Max 10 chars.</small>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="project-description">Description</label>
                        <textarea id="project-description" rows="2" placeholder="Brief project description..."></textarea>
                    </div>
                    
                    <h3 style="margin-top: 25px; margin-bottom: 15px; border-bottom: 1px solid #ddd; padding-bottom: 10px;">Folder & Outlook Settings</h3>
                    <div class="form-group">
                        <label for="project-base-folder">Base Folder Path *</label>
                        <input type="text" id="project-base-folder" required placeholder="e.g., \\server\share\ProjectName">
                        <small class="form-hint">Network path where RFI and Submittal folders will be created.</small>
                    </div>
                    <div class="form-group">
                        <label for="project-outlook-folder">Outlook Folder</label>
                        <input type="text" id="project-outlook-folder" placeholder="Inbox" value="Inbox">
                        <small class="form-hint">Outlook folder to monitor for this project's emails.</small>
                    </div>
                    
                    <h3 style="margin-top: 25px; margin-bottom: 15px; border-bottom: 1px solid #ddd; padding-bottom: 10px;">User Name Patterns (for email filtering)</h3>
                    <div class="form-group">
                        <label for="project-user-names">User Names</label>
                        <textarea id="project-user-names" rows="3" placeholder="Isabel Andaya&#10;Andaya&#10;EoR - Structural"></textarea>
                        <small class="form-hint">Enter one name per line. These patterns are used to detect if you're assigned as reviewer in ACC emails.</small>
                    </div>
                    
                    <h3 style="margin-top: 25px; margin-bottom: 15px; border-bottom: 1px solid #ddd; padding-bottom: 10px;">Excel Tracker Paths (Optional)</h3>
                    <div class="form-group">
                        <label for="project-rfi-excel">RFI Tracker Excel Path</label>
                        <input type="text" id="project-rfi-excel" placeholder="e.g., \\server\share\RFI Tracker.xlsx">
                    </div>
                    <div class="form-group">
                        <label for="project-submittal-excel">Submittal Tracker Excel Path</label>
                        <input type="text" id="project-submittal-excel" placeholder="e.g., \\server\share\Submittal Tracker.xlsx">
                    </div>
                    
                    <button type="submit" class="btn btn-primary btn-full" style="margin-top: 20px;">Create Project</button>
                </form>
            </div>
        </div>
    </div>

    <script src="app.js"></script>
</body>
</html>